{# templates/sitemap/sitemap.html.twig #}
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:image="http://www.google.com/schemas/sitemap-image/1.1">
    {% for url in urls %}
        <url>
            <loc>{{ url.loc }}</loc>
            {% if url.lastmod is defined and url.lastmod %}
                <lastmod>{{ url.lastmod }}</lastmod>
            {% endif %}
            {% if url.changefreq is defined and url.changefreq %}
                <changefreq>{{ url.changefreq }}</changefreq>
            {% endif %}
            {% if url.priority is defined %}
                <priority>{{ url.priority }}</priority>
            {% endif %}

            {# images : accepte un objet unique ou une liste #}
            {% if url.image is defined and url.image %}
                {% set images = (url.image is iterable and (url.image|first is iterable)) ? url.image : [url.image] %}
                {% for image in images %}
                    <image:image>
                        <image:loc>{{ image.loc }}</image:loc>
                        {% if image.title is defined and image.title %}
                            <image:title><![CDATA[{{ image.title }}]]></image:title>
                        {% endif %}
                    </image:image>
                {% endfor %}
            {% endif %}
        </url>
    {% endfor %}
</urlset>
